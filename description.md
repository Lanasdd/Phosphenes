# Phosphenes
## О боте
Данный бот создан для организации тренировочного процесса в волейбольной команде. А именно, для информирования участников команды о важных событиях или каких-либо изменениях в расписании, посредством использования команды send_all и одноименной функции, для рассылки сообщений в определенное время для напоминания о приближающейся тренировке, используя функцию 'send_scheduled_message' и библиотеку schedule, благодаря которой есть возможность планирования выполнения задач в определенное время, для просмотра расписания и результатов игр в различных соревнованиях, , а также для возможности узнать прогноз погоды, что особенно важно в сезон пляжного волейбола, еще бот отправляет напоминания о том, что необходимо пройти опрос, то есть указать, идешь ли ты на тренировку, что является удобной и полезной функцией для тренера, который сможет заранее создать план тренировки.

## Библиотеки
1.	sqlite3: Библиотека для работы с базами данных SQLite.
2.	telebot: Библиотека для работы с Telegram Bot API.
3.	schedule: Библиотека для планирования выполнения задач в определенное время. В данном коде используется для создания расписания отправки сообщений пользователю.
4.	requests: Библиотека для отправки HTTP-запросов. В данном коде используется для отправки GET-запроса к API погоды и получения данных о погоде.

## Функционал
## Рассылка
Существует команда 'total-results', вызвав которую будет  выполняться функция 'total_results'. 
Если chat.id пользователя, отправившего команду, совпадает с admin_id, то каждому пользователю из списка 'users_all' отправляется сообщение, указанное после команды '\send_all'.
Когда сообщение отправится всем пользователям, то админу придет сообщение: 'Сообщение отправлено всем пользователям.', указывая, что сообщение было отправлено всем пользователям.

Если chat.id пользователя, отправившего команду, не совпадает с admin_id, это означает, что у пользователя нет прав на использование данной команды. В этом случае бот отправляет ответ на исходное сообщение: 'У вас нет доступа к этой команде.' указывая, что у пользователя нет доступа к этой команде.

Данная команда и функция необходимы для возможности отправки участникам команды объявлений и каких-либо изменений

## Напоминания
Отправка сообщений по расписанию с использованием библиотеки schedule, планирование выполнения функции send_scheduled_message
Функция send_scheduled_message() отправляет сообщение (message2) списку пользователей (user_ids), внесенных в таблицу базы данных.
Планирование запуска функции send_scheduled_message в определенные дни и время происходит с помощью функции schedule.every().day.at('time').do(function). В моем случае выполнение функции запланировано по средам в 10:00, пятницам в 10:00 и воскресеньям в 10:00.
функция schedule_messages() постоянно проверяет наличие ожидающих запланированных задач и запускает их с помощью schedule.run_pending(). Между проверками она засыпает на 1 секунду с помощью функции time.sleep(1)

Эта функция необходима для оповещения участников команды о необходимости участия в голосовании о посещаемости тренировке, также она может напоминать о приближающейся тренировке

## Голосование
В главном меню пользователь может нажать на кнопку Vote, тем самым сообщив, будет ли он присутствовать на тренировке, о том, что пользователю необходимо принять участие в голосовании, напомнит функция send_scheduled_message().
Выбрав кнопку Vote, пользователь должен выбрать опцию ("Буду" или "Не буду"), соответствующую тому, пойдет он на тренировку или нет. Если текст сообщения пользователя равен "Буду" или "Не буду", то будет вызываться функция 'record_vote'. Затем извлекается идентификатор пользователя, отправившего сообщение. Проверяется, присутствует ли 'user_id' в списке 'allowed_user_ids'. Если пользователь находится в списке 'allowed_user_ids', то его выбор ("Буду" или "Не буду") записывается в словарь 'voting_results' под ключом 'user_id'.

Бот отправляет сообщение пользователю с текстом "Your answer is recorded. Click the button 'Return to the main menu'" для информирования пользователя о том, что его ответ записан.
При необходимости, пользователь может изменить свой выбор

Если пользователь не находится в списке allowed_user_ids, бот отправляет сообщение с текстом "Sorry, you are not allowed to vote", сообщая пользователю, что ему не разрешено голосовать.

Для просмотра реультатов голосования существует команда total_results, вызвав которую, будет выполняться функция total_results.
Проверяется, есть ли пользователь, отправивший команду, в списке разрешенных идентификаторов пользователей. Если нет, то отправляется ответное сообщение о том, что пользователь не имеет права просматривать результаты.
user_names_with_vote1 и user_names_with_vote2 - два списка, которые будут использоваться для хранения имен пользователей, проголосовавших "Буду" и "Не буду" соответственно.
Код проверяет голос пользователя и добавляет его имя либо к user_names_with_vote1, либо к user_names_with_vote2 в зависимости от его выбора.
После обработки всех пользователей код формирует итоговое сообщение с именами пользователей, проголосовавших отдельно "Буду" и "Не буду".
bot.send_message(message.chat.id, result_message): Наконец, в качестве ответа пользователю, подавшему команду /total_results, отправляется сообщение с результатом, в котором отображаются имена пользователей, проголосовавших "Буду" и "Не буду".

Это необходимо для контроля посещаемости, также на основе данного голосования тренер сможет заранее составить план тренировки

## Сброс результатов голосования

Определяется список 'reset_day_of_week', содержащий номера дней недели, в которые необходимо сбросить результаты голосования. В моем коде это понедельник (0), среда (3) и пятница (5).
Для получения текущей даты и времени используется функция 'datetime.datetime.now()'.
Проверяется, есть ли текущий день, заданный функцией now.weekday(), в списке reset_day_of_week. Если да, то используется метод 'clear()' для объекта 'voting_results', происходит сброс результатов голосования.

## Прогноз погоды
Если пользователь выбрал кнопку прогноз погоды, то бот отправит ему сообщение:
'Отправьте боту название города и он скажет, какая там погода'

После указания пользователем города, бот формирует запрос:
url = 'https://api.openweathermap.org/data/2.5/weather?q='+city+'&units=metric&lang=ru&appid= API-токен '

Отправляет запрос на сервер и сразу получает результат
Затем происходит парсинг ответа OpenWeather в формате JSON: заберем данные о городе и температуре, влажности, скорости ветра, восходе, заходе.

Декорируем сообщения, выводим сообщение пользователю.

Возможность посмотреть погоду необходима в сезон пляжного волейбола

## Расписание и результаты 






